---
import Layout from '../layouts/Layout.astro'

---

<Layout title="Essay">
 <form id="essayForm" class="w-full min-h-screen flex flex-col justify-start items-center">
    <textarea class=" focus:ring-transparent w-full sticky top-0 resize-none p-4 text-gray-200 outline-none bg-gray-800 border-b-2 border-gray-700 font-bold" id="question" name="question" placeholder="Essay savolini kiriting..."></textarea>
    <textarea  class="absolute left-0 top-0 w-full bg-gray-800 text-gray-200 italic outline-none p-4 border-t-2 border-gray-700 focus:ring-transparent" id="essay" name="essay" placeholder="Essay matnini kiriting..."></textarea>
    <button disabled id="btn" class="absolute mt-4 bottom-3 px-6 bg-rose-500 text-white text-lg rounded-2xl py-2 px-4" type="button" onclick="submitEssay()">Check Essay</button>
  </form>

  <div class="hidden w-full absolute bg-gray-900 top-0 left-0 text-white flex flex-col justify-center items-center" id="resultContainer">

 
 <svg id="close" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-emerald-500 absolute top-4 right-7">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
</svg>


  <h1 class="my-4 text-3xl font-bold">Writing Assessment</h1>
   <ul class="my-4 container mx-auto px-4">
    <li id="result"><li>
   </ul>
  </div>

</Layout>
<style>
#essay{
    top: 10%;
	height: 80%;
}

#resultContainer{
	height:100%
}

 .paragraph { margin-bottom: 10px; }
    .color-1 { color: blue; }
    .color-2 { color: green; }
    .color-3 { color: purple; }
    .color-4 { color: orange; }
    .color-5 { color: red; }
    .color-6 { color: brown; }
    .color-7 { color: teal; }

</style>



<script is:inline>
    async function submitEssay() {
    
    document.getElementById('btn').innerText="Evaluating..."
    document.getElementById("question").setAttribute('disabled','disabled')

    document.getElementById("essay").setAttribute('disabled','disabled')

    document.getElementById("close").addEventListener('click', ()=>{
        document.getElementById('resultContainer').classList.add('hidden')
        document.getElementById('btn').classList.add('hidden')
    })

      const essay = document.getElementById("essay").value;
      const question = document.getElementById("question").value
      document.getElementById("essay").addEventListener('input', ()=>{
	document.getElementById('btn').removeAttribute("disabled")
      }
      const response = await fetch('/api/check', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ essay, question }),
      });

      const result = await response.json();

      const resultContainer = document.getElementById('resultContainer');
      const resultDiv = document.getElementById('result');

      resultContainer.classList.remove('hidden');
      resultDiv.innerHTML = "";

      // Split the text into paragraphs and assign unique colors
      result.choices[0].text.split('\n').forEach((paragraph, index) => {
        const paragraphElement = document.createElement('p');
        paragraphElement.textContent = paragraph;
        resultDiv.appendChild(paragraphElement);
      });
    }
  </script>

---
import Layout from '../layouts/Layout.astro'
import TopUser from '@components/TopUser.astro'
import { app } from "../lib/firebase/server";
import { getAuth } from "firebase-admin/auth";
import { getFirestore } from "firebase-admin/firestore";
import Card from '@components/Card.astro';
import Intro from '@components/Intro.astro';


const auth = getAuth(app);
const db = getFirestore(app)

/* Check current session */
if (!Astro.cookies.has("session")) {
  return Astro.redirect("/signin");
}
const sessionCookie = Astro.cookies.get("session").value;
const decodedCookie = await auth.verifySessionCookie(sessionCookie);
const user = await auth.getUser(decodedCookie.uid);


const userRef = db.collection("users").doc(user.uid)
const userSnapshot = await userRef.get();
const userData = userSnapshot.data();

const {picture, name} = userData
---
<Layout title="Exam Online - Multilevel imtihoniga tayyorlovchi platforma">
  <Intro/>
<section class="hidden" id="main-screen" transition:animate="slide">
<TopUser
name={name || "Guest"}
picture={picture || "/static/img/avatar.png"}
/>
    
<main class="w-full flex flex-col justify-center items-center mt-4 ">
 
    <Card/>
    <button onclick="window.location.href='https://my.gov.uz/oz/determining-lang-level-v1/choosing-test-region-applicant/update?id=105415564'" class="rounded-2xl shadow-xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white text-lg py-2.5 px-5 w-[80%] sm:w-[400px] flex items-center justify-center">Sertifikatga topshirish
<svg xmlns="http://www.w3.org/2000/svg" class="ml-2 text-white icon icon-tabler icon-tabler-arrow-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l14 0" /><path d="M13 18l6 -6" /><path d="M13 6l6 6" /></svg>
</button>
</main>  
<div class="h-[50px]"></div>
</section>  
</Layout>

<script is:inline>

  var notVisible = localStorage.getItem("visible")

  if(!notVisible){
    document.getElementById("swipe").classList.remove("display-none");
    document.getElementById("hide-intro").addEventListener("click", ()=>{
      document.getElementById("main-screen").classList.remove("hidden");
      document.getElementById("swipe").classList.add("display-none");
      localStorage.setItem("visible", "true")
    })
  }
  else{
    document.getElementById("main-screen").classList.remove("hidden");
    document.getElementById("swipe").classList.add("display-none");
  }



</script>


<style>


/* Course Slider Styles */
.course-slider {
  white-space: nowrap;
  overflow-x: auto;
}

@media only screen and (max-width: 768px) {
/* Course Slider Styles */
  .course-slider {
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 10px;
  }
}
</style>

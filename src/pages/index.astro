---
import Layout from "@layouts/Layout.astro";
import SignIn from "@components/SignIn.astro";
---

<Layout title="Sign in">
  <SignIn />
</Layout>
<script>
  import {
    getAuth,
    signInWithEmailAndPassword
  } from "firebase/auth";
  import { app } from "@lib/firebase/client";

  const auth = getAuth(app);
  const form = document.querySelector("form") as HTMLFormElement;
  const loader = document.getElementById("loader")

  
  var userLoggedIn = localStorage.getItem('user')

  if(userLoggedIn){
    window.location.href = '/dashboard/index.html'
  }

  form.addEventListener("submit", async (e) => {

    loader.classList.remove('hidden')
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get("email")?.toString();
    const password = formData.get("password")?.toString();

    if (!email || !password) {
      return;
    }

  signInWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    localStorage.setItem('user', JSON.stringify(user))
    window.location.href='/dashboard/index.html'
  })
  .catch((error) => {
    loader.classList.add('hidden')
    const errorMessage = error.message;
    alert(errorMessage)
  });

  });


</script>


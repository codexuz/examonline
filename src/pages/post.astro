---
import EditorLayout from "@layouts/EditorLayout.astro";
import EditorJs from '@components/editor/EditorJs.astro'
---

<EditorLayout title="Blog yaratish">
   <EditorJs/>
</EditorLayout>

<script>
import EditorJS from '@editorjs/editorjs';
import Header from '@editorjs/header'; 
import List from '@editorjs/list'; 
import TelegramPost from 'editorjs-telegram-post';
import Embed from '@editorjs/embed';
import Checklist from '@editorjs/checklist'
import Paragraph from 'editorjs-paragraph-with-alignment';
import Quote from '@editorjs/quote';
import RawTool from '@editorjs/raw';
import InlineImage from 'editorjs-inline-image';
import edjsParser  from "editorjs-parser";
import Marker from '@editorjs/marker';
import AudioPlayer from 'editorjs-audio-player';
import Title from "title-editorjs";
import AttachesTool from '@editorjs/attaches';





const parser = new edjsParser();

const editor = new EditorJS({
  holder: 'editorjs',
  placeholder: 'Matn kiritishni boshlang...',
  tools: { 
    header: Header, 
    audioPlayer: AudioPlayer,
    list: List,
    telegramPost: TelegramPost,
    quote: Quote,
    title: Title,
    raw: RawTool,
    Marker: {
      class: Marker,
      shortcut: 'CMD+SHIFT+M',
    },
    paragraph: {
      class: Paragraph,
      inlineToolbar: true,
    },
     embed: {
      class: Embed,
      inlineToolbar: true,
      config: {
        services: {
          youtube: true,
          coub: true
        }
      }
    },
    checklist: {
      class: Checklist,
      inlineToolbar: true,
    },
    image: {
        class: InlineImage,
        inlineToolbar: true,
        config: {
          embed: {
            display: true,
          },
          unsplash: {
            appName: 'Demi',
            clientId: 'HQfDEZ3lQvufvIZ2WBM8CGRcgUnHrZKQFr0YqG6r8Cw'
          }
        }
      },
      


 
  }


});



document.getElementById('save').addEventListener('click', async ()=>{
    editor.save().then( async (outputData) => {
    const text = parser.parse(outputData);
    //console.log(JSON.stringify(text))
    const response = await fetch('/api/blog', {
    method: 'POST',
    body: JSON.stringify(text),
    headers: {
        'Content-Type': 'application/json'
      }
    }) 
    
     // Check if the response status is ok (2xx)
    if (response.ok) {
      const data = await response.json();
      console.log(data);
    } else {
      // If the response status is not ok, handle the error
      console.log('Server responded with error:', response.statusText);
    }

  }).catch((error) => {
  console.log('Saving failed: ', error)
});

})


</script>
